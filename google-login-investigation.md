# Googleログイン不具合調査報告

## 概要
Googleログインが1回目は成功するが、2回目以降に失敗する現象について調査を行いました。

## 原因
`src/context/AuthContext.tsx` の `logout` 処理において、セッションのクリアが不完全であることが原因です。

現在の実装では、アプリケーション独自のセッション管理（`auth_token` クッキー）のみを削除しており、Google認証ライブラリ（NextAuth.js）のセッション削除が行われていません。

## 詳細メカニズム
1. **1回目のログイン**:
   - NextAuthのセッションが作成されます。
   - アプリケーション独自の `auth_token` が発行されます。
   - ログイン成功。

2. **ログアウト実行**:
   - `auth_token` は削除されます（アプリ上はログアウト状態）。
   - **しかし、NextAuthのセッションクッキーはブラウザに残ったままになります。**

3. **2回目のログイン**:
   - ユーザーが「Googleでログイン」ボタンを押します。
   - NextAuthは、ブラウザに既存の有効なセッションが残っているため、「既にログイン済み」と判断します。
   - これにより、期待される認証コールバック処理（Googleの認証画面への遷移や、新しいトークンの発行トリガー）が正常に実行されず、アプリ側との状態不整合が発生してログイン処理が完了しません。

## 解決策
`src/context/AuthContext.tsx` の `logout` 関数内で、NextAuthが提供する `signOut` 関数を呼び出すように修正する必要があります。これにより、ログアウト時に両方のセッション（アプリ独自とNextAuth）が確実にクリアされ、次回のログイン時にクリーンな状態から開始できるようになります。
